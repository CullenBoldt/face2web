steps:
- name: gcr.io/cloud-builders/docker
  args:
  - build
  - -t
  - ${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_SERVICE_NAME}:${_SHORT_SHA}
  - .
- name: gcr.io/cloud-builders/docker
  args:
  - push
  - ${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_SERVICE_NAME}:${_SHORT_SHA}
- name: gcr.io/google.com/cloudsdktool/google-cloud-cli
  entrypoint: gcloud
  args:
  - run
  - deploy
  - ${_SERVICE_NAME}
  - --image=${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_SERVICE_NAME}:${_SHORT_SHA}
  - --region=${_REGION}
  - --allow-unauthenticated
  - --platform=managed
images:
- ${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_SERVICE_NAME}:${_SHORT_SHA}
substitutions:
  _SERVICE_NAME: sbiprujzwnqmeodqkvkvpmmsuwiprr
  _REPOSITORY: sbiprujzwnqmeodqkvkvpmmsuwiprr-repo
  _REGION: europe-west1
  _SHORT_SHA: latest
